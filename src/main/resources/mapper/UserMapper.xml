<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="user">

    <select id="getUserById" parameterType="string" resultType="User">
        SELECT id, password, artist, role, profile_img profileImg
        FROM user WHERE id = #{id}
    </select>

    <insert id="signUp" parameterType="User">
        INSERT INTO user (id, password, artist, role) VALUES (#{id}, #{password}, #{artist}, default)
    </insert>

    <insert id="insertPlaylist" parameterType="User">
        INSERT INTO playlist (playlist_code, id) VALUES ((select nextval('PLAYLIST_CODE_SEQ') from dual), #{id})
    </insert>

    <update id="updateProfile" parameterType="User">
        update user
        <set>
            <if test="artist != null and artist != ''">
                artist = #{artist},
            </if>
            <if test="profileImg != null and profileImg != ''">
                profile_img = #{profileImg},
            </if>
            <if test="newId != null and newId != ''">
                id = #{newId},
            </if>
        </set>
        where id = #{id}
    </update>

    <select id="getMyUploadList" parameterType="String" resultType="Music">
        SELECT music_code musicCode, title, lyrics, release_date releaseDate, mp3_path mp3Path, img_path imgPath, file_size fileSize, runtime, views, genre_code genreCode, m.id id, u.artist artist
        FROM music m join user u on m.id = u.id WHERE u.id = #{id}
    </select>

    <select id="getMyFavoriteList" parameterType="String" resultType="Music">
        select m.music_code musicCode, title, lyrics, release_date releaseDate, mp3_path mp3Path, img_path imgPath, file_size fileSize, runtime, views, genre_code genreCode, m.id id, u.artist artist
        from music m
                 join user u on m.id = u.id
                 join favorite f on m.music_code = f.music_code
        where f.id = #{id} order by like_date desc
    </select>

    <select id="getMyPlaylistList" parameterType="String" resultType="Playlist">
        select * from playlist where id = #{id}
    </select>

    <select id="getMyReviewList" parameterType="String" resultType="Review">
        select review_id reviewId, review_contents reviewContents, review_depth reviewDepth, review_regdate reviewRegdate, review_like reviewLike, parent_id parentId, m.id id, u.artist artist, r.music_code musicCode, m.img_path imgPath, m.title title
        from review r
                 join music m on r.music_code = m.music_code
                 join user u on u.id = m.id
        where r.id = #{id} order by review_regdate desc
    </select>

</mapper>
