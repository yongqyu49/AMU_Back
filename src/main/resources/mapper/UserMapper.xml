<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="user">

    <select id="getUserById" parameterType="string" resultType="User">
        SELECT id, password, artist, role, profile_img profileImg  FROM user WHERE id = #{id}
    </select>

    <insert id="signUp" parameterType="User">
        insert into user(id, password, artist, role) VALUES (#{id}, #{password}, #{artist}, default)
    </insert>

    <update id="updateProfile" parameterType="User">
        update user
        <set>
            <if test="artist != null and artist != ''">
                artist = #{artist},
            </if>
            <if test="profileImg != null and profileImg != ''">
                profile_img = #{profileImg},
            </if>
            <if test="newId != null and newId != ''">
                id = #{newId},
            </if>
        </set>
        where id = #{id}
    </update>

    <select id="getMyUploadList" parameterType="String" resultType="Music">
        SELECT music_code musicCode, title, lyrics, release_date releaseDate, mp3_path mp3Path, img_path imgPath, file_size fileSize, runtime, views, genre_code genreCode, m.id id, u.artist artist
        FROM music m join user u on m.id = u.id WHERE u.id = #{id}
    </select>

    <select id="getMyFavoriteList" parameterType="String" resultType="Music">
        select music_code musicCode, title, lyrics, release_date releaseDate, mp3_path mp3Path, img_path imgPath, file_size fileSize, runtime, views, genre_code genreCode, m.id id, u.artist artist
        from music m join user u on m.id = u.id
        where music_code
                  in (select music_code from favorite where u.id = #{id} order by like_date desc)
    </select>

    <select id="getMyPlaylistList" parameterType="String" resultType="Playlist">
        select * from playlist where id = #{id}
    </select>

    <select id="getMyReviewList" parameterType="String" resultType="Review">
        select review_id reviewId, review_contents reviewContents, review_depth reviewDepth, review_regdate reviewRegdate, review_like reviewLike, parent_id parentId, id, music_code musicCode
        from review where id = #{id} and music_code in (select music_code from music)
    </select>

</mapper>
